<!-- comment-modal.html : fragment v3 compatible with comment-modal.js v3 -->
<div th:fragment="commentModal">
  <div class="modal fade" id="commentsModal" tabindex="-1" aria-labelledby="commentsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <!-- Header -->
        <div class="modal-header">
          <h5 class="modal-title" id="commentsModalLabel">댓글</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

          <!-- Sort dropdown -->
          <div class="dropdown ms-auto">
            <button class="btn btn-secondary dropdown-toggle" id="sortButton" data-bs-toggle="dropdown" aria-expanded="false">최신순</button>
            <ul class="dropdown-menu" aria-labelledby="sortButton">
              <li><a class="dropdown-item" href="#" id="sortLatest">최신순</a></li>
              <li><a class="dropdown-item" href="#" id="sortOldest">오래된 순</a></li>
            </ul>
          </div>
        </div>

        <!-- Body -->
        <div class="modal-body d-flex" id="modal-body">
          <!-- Comment list -->
          <div class="comment-section flex-grow-1 me-3" style="max-height:450px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none;">
            <!-- Top-level comment writer -->
            <div class="comment p-2 border-bottom">
              <textarea class="form-control mb-2" placeholder="댓글을 입력하세요..."></textarea>
              <button class="btn btn-primary btn-sm">댓글 작성</button>
            </div>

            <!-- Server‑rendered comments -->
            <div th:each="c,stat:${problemComments}" class="comment p-2 border-bottom" th:data-comment-id="${c.commentId}">
              <div class="comment-header small text-muted mb-1">
                <span th:text="${c.author}"></span> • <span th:text="${c.createdAt}"></span> • <span th:text="'LV '+${c.level}"></span>
              </div>
              <p class="m-0" th:text="${c.commentContent}"></p>
              <div class="d-flex gap-2 mt-2">
                <button class="btn btn-link p-0" th:attr="data-reply-open=${stat.index}">답글 달기</button>
                <button class="btn btn-link p-0" th:attr="data-reply-toggle=${stat.index},data-parent=${c.commentId}" th:text="'답글 보기('+${c.replyCount}+')'"></button>
                <button class="btn btn-link p-0 text-danger">신고</button>
              </div>
              <div class="reply-section mt-2" th:id="'reply'+${stat.index}" style="display:none;">
                <textarea class="form-control mb-2" placeholder="답글을 입력하세요..."></textarea>
                <button class="btn btn-sm btn-primary" data-write-reply  th:attr="data-parent=${c.commentId}">답글 작성</button>
              </div>
            </div>
          </div>

          <!-- Cursor for infinite scroll -->
          <input type="hidden" id="cursor" th:value="${cursor}" />

          <!-- Reply list column -->
          <div class="reply-list flex-grow-1" style="display:none;max-height:400px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none;"></div>
        </div>

        <!-- Footer -->
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div>



  <script th:src="@{/js/commentModal.js}"></script>

</div>
